<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVVEX COMMAND CENTER | PRIVATE ACCESS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap');
        
        :root {
            --neon-cyan: #00f2ff;
            --neon-purple: #7000ff;
            --bg-dark: #050505;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Rajdhani', sans-serif;
            background-image: radial-gradient(circle at 50% -20%, #1a1a2e 0%, #050505 80%);
            min-height: 100vh;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }

        .glass-panel {
            background: rgba(15, 15, 25, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 242, 255, 0.2);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }

        .input-dark {
            background: rgba(0, 0, 0, 0.5) !important;
            border: 1px solid #222 !important;
            color: white !important;
            transition: all 0.3s ease;
        }

        .input-dark:focus {
            border-color: var(--neon-cyan) !important;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
            outline: none;
        }

        .btn-main {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            color: black;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .btn-main:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(0, 242, 255, 0.5);
            filter: brightness(1.2);
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 242, 255, 0.1);
            border-top: 3px solid var(--neon-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #image-preview {
            border: 1px solid rgba(0, 242, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-height: 500px;
            object-fit: contain;
        }
    </style>
</head>
<body class="p-4 lg:p-10">

<div class="max-w-6xl mx-auto">
    <header class="flex flex-col md:flex-row justify-between items-center mb-10 border-b border-cyan-900/50 pb-6">
        <div class="text-center md:text-left">
            <h1 class="orbitron text-4xl font-black text-cyan-400 tracking-tighter uppercase">NVVEX ENGINE</h1>
            <p class="text-gray-500 text-xs tracking-[0.5em] uppercase mt-1">Lado Oscuro Terminal • 8K Generation</p>
        </div>
        <div class="flex items-center gap-4 mt-6 md:mt-0">
            <div class="text-right hidden md:block">
                <p class="text-[10px] text-gray-400 uppercase">Status del Enlace</p>
                <p class="text-xs text-green-400 font-bold">LLAVE VINCULADA ✓</p>
            </div>
            <div class="h-10 w-10 rounded-full border border-cyan-500 flex items-center justify-center animate-pulse">
                <div class="h-2 w-2 bg-cyan-400 rounded-full"></div>
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <aside class="lg:col-span-4 space-y-6">
            <div class="glass-panel p-6 rounded-2xl">
                <h2 class="orbitron text-sm text-cyan-400 mb-6 border-b border-gray-800 pb-2 italic">CONFIGURACIÓN DE CARGA</h2>
                
                <div class="space-y-5">
                    <div>
                        <label class="block text-[10px] text-gray-400 uppercase mb-2 tracking-widest">1. Perfil del Artista</label>
                        <input type="file" id="fileInput" accept="image/*" class="input-dark w-full p-2 rounded-lg text-xs">
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-400 uppercase mb-2 tracking-widest">2. Órdenes Especiales (Prompt)</label>
                        <textarea id="userPrompt" rows="4" class="input-dark w-full p-3 rounded-lg text-sm" placeholder="Ej: sentado en un trono de fibra de carbono, diamantes cayendo del techo, estilo futurista..."></textarea>
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-400 uppercase mb-2 tracking-widest">3. Entorno Predefinido</label>
                        <select id="stylePreset" class="input-dark w-full p-3 rounded-lg text-sm">
                            <option value="futuristic underground bunker in Mayaguez, intense cyan and purple neon lights, steam and metallic reflections">EL BÚNKER (ESTILO NVVEX)</option>
                            <option value="luxury private jet interior, gold accents, sunset through window, elite aesthetic">JET PRIVADO (LUJO)</option>
                            <option value="dark street alley, heavy rain, glowing graffiti, cinematic orange lighting">CALLE OSCURA (URBANO)</option>
                            <option value="professional recording studio, acoustic foam walls, high-end microphones, purple ambient light">ESTUDIO DE GRABACIÓN</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-[10px] text-gray-400 uppercase mb-2 tracking-widest">4. Formato de Salida</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="format-btn p-2 border border-gray-700 rounded text-xs hover:border-cyan-400" onclick="setFormat('square')">CUADRADO (IG)</button>
                            <button class="format-btn p-2 border border-gray-700 rounded text-xs hover:border-cyan-400" onclick="setFormat('portrait')">STORY / TIKTOK</button>
                        </div>
                    </div>

                    <button onclick="generate()" id="genBtn" class="btn-main w-full py-4 mt-4 rounded-xl orbitron text-sm shadow-lg">
                        Generar Arte Final
                    </button>
                </div>
            </div>
        </aside>

        <main class="lg:col-span-8 space-y-6">
            <div class="glass-panel p-4 rounded-2xl min-h-[500px] flex flex-col items-center justify-center relative overflow-hidden">
                <div id="loading" class="hidden flex flex-col items-center z-10">
                    <div class="loader mb-4"></div>
                    <p class="orbitron text-xs text-cyan-400 animate-pulse uppercase tracking-[0.3em]">Procesando ADN Visual...</p>
                </div>

                <img id="image-preview" src="https://via.placeholder.com/1080x1080/050505/111?text=SISTEMA+LISTO+PARA+GENERAR" alt="Preview" class="rounded-xl w-full">
                
                <div id="action-buttons" class="hidden absolute bottom-8 flex gap-4">
                    <a id="downloadBtn" href="#" download="NVVEX_ARTE_8K.jpg" class="bg-white text-black px-6 py-2 rounded-full font-bold text-xs uppercase hover:bg-cyan-400 transition-all">Descargar 8K</a>
                </div>
            </div>
        </main>
    </div>
</div>

<script type="module">
    import { fal } from "https://cdn.jsdelivr.net/npm/@fal-ai/serverless-client@latest/dist/index.js";

    // LLAVE INTEGRADA
    const TOKEN = "8c91b823-078d-417b-8821-cb7d31bde10a:c8458455a42fcf6e4f1496b82587e6af";
    let currentFormat = "square";

    window.setFormat = (f) => {
        currentFormat = f;
        alert("Formato cambiado a: " + f);
    }

    window.generate = async () => {
        const file = document.getElementById('fileInput').files[0];
        const userPrompt = document.getElementById('userPrompt').value;
        const style = document.getElementById('stylePreset').value;
        const loading = document.getElementById('loading');
        const preview = document.getElementById('image-preview');
        const actions = document.getElementById('action-buttons');
        const download = document.getElementById('downloadBtn');

        if (!file) return alert("Socio, sube la foto primero.");

        loading.classList.remove('hidden');
        preview.style.opacity = "0.2";
        actions.classList.add('hidden');

        try {
            // 1. Subir imagen temporal
            const imageUrl = await fal.storage.upload(file);

            // 2. Construir Prompt Élite
            const fullPrompt = `Masterpiece realistic 8k photo of the person in the image, ${style}, ${userPrompt}, hyper-detailed skin, cinematic lighting, sharp focus, high fashion, trending on artstation.`;

            // 3. Llamar al Lado Oscuro (Flux Pro)
            const result = await fal.subscribe("fal-ai/flux/pro", {
                input: {
                    prompt: fullPrompt,
                    image_url: imageUrl,
                    image_size: currentFormat === 'square' ? 'square_hd' : 'portrait_4_5',
                    sync_mode: true
                },
                credentials: TOKEN
            });

            // 4. Mostrar Resultado
            preview.src = result.images[0].url;
            download.href = result.images[0].url;
            
            preview.style.opacity = "1";
            loading.classList.add('hidden');
            actions.classList.remove('hidden');

        } catch (err) {
            console.error(err);
            alert("Error: Revisa tu saldo en Fal.ai o la conexión.");
            loading.classList.add('hidden');
            preview.style.opacity = "1";
        }
    }
</script>

</body>
</html>
